<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/baby.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/baby.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/baby.png">
  <link rel="mask-icon" href="/images/baby.png" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Palatino:300,300italic,400,400italic,700,700italic|Monaco:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"thesong96.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="##Camera 成像原理  Optical Flow Intrisic and Extrinsic Matrix Terminology Review  Object Detections  paper review + blog + algorithm reproduction SPPNet Selective Search R-CNN Fast-RCNN Faster-RCNN Yolo 1">
<meta property="og:type" content="article">
<meta property="og:title" content="Object Detection Algorithms Review">
<meta property="og:url" content="https://thesong96.github.io/2020/03/30/Region-Proposal/index.html">
<meta property="og:site_name" content="TheSong">
<meta property="og:description" content="##Camera 成像原理  Optical Flow Intrisic and Extrinsic Matrix Terminology Review  Object Detections  paper review + blog + algorithm reproduction SPPNet Selective Search R-CNN Fast-RCNN Faster-RCNN Yolo 1">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/8DMfFLF.jpg">
<meta property="og:image" content="https://i.imgur.com/0HeprSV.png">
<meta property="og:image" content="https://i.imgur.com/8cBUHow.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/uploads/2017/09/breakfast_oversegment-300x200.jpg">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/uploads/2017/09/hierarchical-segmentation-1.jpg">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-3a99604c3b9fc1664b0ebd9b16aa190c_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-34d855e06476464bdb18051a043565ab_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-19a1201960f1c720275a7fd8ab39ea27_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-169d419080f56b69f9645cd13ee5b0ac_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-a9283008bc26743f78b7ac5644fa42d7_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-19a1201960f1c720275a7fd8ab39ea27_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-ed6bd32a9661aa84228d1ca1c75f5d29_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-301d49b3076ccce5448547f0910f2bc0_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-3fa563d6b892f311bf3e1c27ee15fe97_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-58103e9010f6c91d7c4f4b38b28fe341_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-3fa563d6b892f311bf3e1c27ee15fe97_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-58103e9010f6c91d7c4f4b38b28fe341_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-9a3fdf638488b3c77915b9b83bf2f3e1_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-2a6ada491e170016c4a765f114cfd18b_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-3fa563d6b892f311bf3e1c27ee15fe97_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-58103e9010f6c91d7c4f4b38b28fe341_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-67a3c5c3f45a9407ee513056c759f095_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-3fa563d6b892f311bf3e1c27ee15fe97_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-58103e9010f6c91d7c4f4b38b28fe341_l3.png">
<meta property="og:image" content="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-f58c2a1aace1c9f1cf8597ddef03ab60_l3.png">
<meta property="og:image" content="https://i.imgur.com/Ija12KT.png">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Precisionrecall.svg/350px-Precisionrecall.svg.png">
<meta property="og:image" content="https://i.imgur.com/IlBW3bP.png">
<meta property="article:published_time" content="2020-03-30T07:41:28.000Z">
<meta property="article:modified_time" content="2021-08-07T05:00:42.826Z">
<meta property="article:author" content="Nansong Yi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/8DMfFLF.jpg">

<link rel="canonical" href="https://thesong96.github.io/2020/03/30/Region-Proposal/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Object Detection Algorithms Review | TheSong</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss.xml" title="TheSong" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">TheSong</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

      
    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://thesong96.github.io/2020/03/30/Region-Proposal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/baby.png">
      <meta itemprop="name" content="Nansong Yi">
      <meta itemprop="description" content="TheSong is named after IG.TheShy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TheSong">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Object Detection Algorithms Review
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-30 00:41:28" itemprop="dateCreated datePublished" datetime="2020-03-30T00:41:28-07:00">2020-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-08-06 22:00:42" itemprop="dateModified" datetime="2021-08-06T22:00:42-07:00">2021-08-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>##Camera 成像原理</p>
<ul>
<li><p>Optical Flow</p></li>
<li><p><a href="https://thesong96.github.io/2020/02/27/Camera-Matrix/">Intrisic and Extrinsic Matrix</a></p></li>
<li><p>Terminology Review</p></li>
</ul>
<h2 id="object-detections">Object Detections</h2>
<ul>
<li>paper review + blog + algorithm reproduction</li>
<li>SPPNet</li>
<li>Selective Search</li>
<li>R-CNN</li>
<li>Fast-RCNN</li>
<li>Faster-RCNN</li>
<li>Yolo 1,2,3</li>
</ul>
<h2 id="image-segementationsemantic-segmentation">Image Segementation/Semantic Segmentation</h2>
<ul>
<li><p>Vanilla FCN</p></li>
<li><p>U-Net</p></li>
<li><p>SegNet</p></li>
<li><p>DenseNet</p></li>
<li><p>BlitzNet</p></li>
<li><p>Mask-RCNN</p></li>
<li><p>Mask RCNN with the Fully Convolutional Network (FCN) branch achieved the highest performance.</p></li>
</ul>
<h2 id="metrics">Metrics:</h2>
<h3 id="accuracy">Accuracy</h3>
<ul>
<li>accuracy is a bad metric, especially when dataset is imbalenced.
<ul>
<li>class imbalance, e.g. 广告点击率,很多广告<span class="math inline">\((x_i, y_i) i = 0, 1, 2 … n\)</span>, <span class="math inline">\(x_i\)</span>表示第i个广告, <span class="math inline">\(y_i\)</span>表示第i个广告是否被click. 就会出现有大量的<span class="math inline">\(y = 0\)</span>, 这样就是positive data很少很少. 如果用accuracy这个metric去optimize model, 就会得到一个model <span class="math inline">\(F \rightarrow F(x_i) = 0\)</span>, 我们的accuracy会很高, 但是这个model就没什么用, 并不能起到预测广告是否会被点击的作用</li>
<li></li>
</ul></li>
</ul>
<h3 id="precision-recall"><strong>Precision &amp; recall</strong></h3>
<ul>
<li><p>Precision: how good is your prediction</p>
<p>那为啥不用 <span class="math inline">\(\frac{TN}{(TN + FN)}\)</span></p></li>
<li><p>Recall: how good to find out all positive</p></li>
</ul>
<figure>
<img src="https://i.imgur.com/8DMfFLF.jpg" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>
<h3 id="precision---recall-curve">Precision - Recall Curve</h3>
<h3 id="roc-curve-tpr---fpr">ROC curve: TPR - FPR</h3>
<h3 id="iou-intersection-over-union"><strong>IoU (Intersection over union)</strong></h3>
<figure>
<img src="https://i.imgur.com/0HeprSV.png" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>
<h2 id="yolov1">YOLOv1</h2>
<p><a href="https://arxiv.org/pdf/1506.02640.pdf" target="_blank" rel="noopener">paper</a></p>
<p>​</p>
<p>An important property of a region proposal method is to have a very <strong>high recall</strong>. This is just a fancy way of saying that the regions that contain the objects we are looking have to be in our list of region proposals. To accomplish this our list of region proposals may end up having a lot of regions that do not contain any object. In other words, it is ok for the region proposal algorithm to produce a lot of false positives so long as it catches all the true positives. Most of these false positives will be rejected by object recognition algorithm. The time it takes to do the detection goes up when we have more false positives and the accuracy is affected slightly. But having a high recall is still a good idea because the alternative of missing the regions containing the actual objects severely impacts the detection rate.</p>
<h2 id="what-is-selective-search">What is Selective Search?</h2>
<p>Selective Search is a region proposal algorithm used in object detection. It is designed to be fast with a very high recall. It is based on computing hierarchical grouping of similar regions based on color, texture, size and shape compatibility.</p>
<p>Selective Search starts by over-segmenting the image based on intensity of the pixels using a graph-based <a href="http://cs.brown.edu/~pff/segment/" target="_blank" rel="noopener">segmentation method</a> by Felzenszwalb and Huttenlocher. The output of the algorithm is shown below. The image on the right contains segmented regions represented using solid colors.</p>
<figure>
<img src="https://i.imgur.com/8cBUHow.png" alt="image-20200330115743624" /><figcaption aria-hidden="true">image-20200330115743624</figcaption>
</figure>
<p>Can we use segmented parts in this image as region proposals? The answer is no and there are two reasons why we cannot do that:</p>
<ol type="1">
<li>Most of the actual objects in the original image contain 2 or more segmented parts</li>
<li>Region proposals for occluded objects such as the plate covered by the cup or the cup filled with coffee cannot be generated using this method</li>
</ol>
<p>If we try to address the first problem by further merging the adjacent regions similar to each other we will end up with one segmented region covering two objects.</p>
<p>Selective search uses oversegments from Felzenszwalb and Huttenlocher’s method as an initial seed. An oversegmented image looks like this.</p>
<p><a href="https://www.learnopencv.com/wp-content/uploads/2017/09/breakfast_oversegment.jpg" target="_blank" rel="noopener"><img src="https://www.learnopencv.com/wp-content/uploads/2017/09/breakfast_oversegment-300x200.jpg" alt="Oversegmented Image" /></a>Oversegmented Image</p>
<p>Selective Search algorithm takes these oversegments as initial input and performs the following steps</p>
<ol type="1">
<li>Add all bounding boxes corresponding to segmented parts to the list of regional proposals</li>
<li>Group adjacent segments based on similarity</li>
<li>Go to step 1</li>
</ol>
<p>At each iteration, larger segments are formed and added to the list of region proposals. Hence we create region proposals from smaller segments to larger segments in a bottom-up approach. This is what we mean by computing “hierarchical” segmentations using Felzenszwalb and Huttenlocher’s oversegments.</p>
<figure>
<img src="https://www.learnopencv.com/wp-content/uploads/2017/09/hierarchical-segmentation-1.jpg" alt="Hierarchical Segmentation for region proposal generation at multiple scales" /><figcaption aria-hidden="true">Hierarchical Segmentation for region proposal generation at multiple scales</figcaption>
</figure>
<p>This image shows the initial, middle and last step of the hierarchical segmentation process.</p>
<h1 id="similarity">Similarity</h1>
<p>Let’s dive deeper into how do we calculate the similarity between two regions.</p>
<p>Selective Search uses 4 similarity measures based on color, texture, size and shape compatibility.</p>
<h2 id="color-similarity">Color Similarity</h2>
<p>A color histogram of 25 bins is calculated for each channel of the image and histograms for all channels are concatenated to obtain a color descriptor resulting into a 25×3 = 75-dimensional color descriptor.</p>
<p>Color similarity of two regions is based on histogram intersection and can be calculated as:</p>
<figure>
<img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-3a99604c3b9fc1664b0ebd9b16aa190c_l3.png" alt="{color}(r_i, r_j) = {k=1}^n min(c^k_i, c^k_j)" /><figcaption aria-hidden="true"><em>{color}(r_i, r_j) = </em>{k=1}^n min(c^k_i, c^k_j)</figcaption>
</figure>
<p><img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-34d855e06476464bdb18051a043565ab_l3.png" alt="c^k_i" /> is the histogram value for <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-19a1201960f1c720275a7fd8ab39ea27_l3.png" alt="k^{th}" /> bin in color descriptor</p>
<h2 id="texture-similarity">Texture Similarity</h2>
<p>Texture features are calculated by extracting Gaussian derivatives at 8 orientations for each channel. For each orientation and for each color channel, a 10-bin histogram is computed resulting into a 10x8x3 = 240-dimensional feature descriptor.</p>
<p>Texture similarity of two regions is also calculated using histogram intersections.</p>
<figure>
<img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-169d419080f56b69f9645cd13ee5b0ac_l3.png" alt="s_{texture}(r_i, r_j) = _{k=1}^n min(t^k_i, t^k_j)" /><figcaption aria-hidden="true">s_{texture}(r_i, r_j) = _{k=1}^n min(t^k_i, t^k_j)</figcaption>
</figure>
<p><img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-a9283008bc26743f78b7ac5644fa42d7_l3.png" alt="t^k_i" /> is the histogram value for <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-19a1201960f1c720275a7fd8ab39ea27_l3.png" alt="k^{th}" /> bin in texture descriptor</p>
<h2 id="size-similarity">Size Similarity</h2>
<p>Size similarity encourages smaller regions to merge early. It ensures that region proposals at all scales are formed at all parts of the image. If this similarity measure is not taken into consideration a single region will keep gobbling up all the smaller adjacent regions one by one and hence region proposals at multiple scales will be generated at this location only. Size similarity is defined as:</p>
<figure>
<img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-ed6bd32a9661aa84228d1ca1c75f5d29_l3.png" alt="s_{size}(r_i, r_j) = 1 - " /><figcaption aria-hidden="true">s_{size}(r_i, r_j) = 1 - </figcaption>
</figure>
<p>where <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-301d49b3076ccce5448547f0910f2bc0_l3.png" alt="size(im)" /> is size of image in pixels.</p>
<h2 id="shape-compatibility">Shape Compatibility</h2>
<p>Shape compatibility measures how well two regions (<img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-3fa563d6b892f311bf3e1c27ee15fe97_l3.png" alt="r_i" /> and <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-58103e9010f6c91d7c4f4b38b28fe341_l3.png" alt="r_j" />) fit into each other. If <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-3fa563d6b892f311bf3e1c27ee15fe97_l3.png" alt="r_i" /> fits into <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-58103e9010f6c91d7c4f4b38b28fe341_l3.png" alt="r_j" /> we would like to merge them in order to fill gaps and if they are not even touching each other they should not be merged.</p>
<p>Shape compatibility is defined as:</p>
<figure>
<img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-9a3fdf638488b3c77915b9b83bf2f3e1_l3.png" alt="s_{fill}(r_i, r_j) = 1 - " /><figcaption aria-hidden="true">s_{fill}(r_i, r_j) = 1 - </figcaption>
</figure>
<p>where <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-2a6ada491e170016c4a765f114cfd18b_l3.png" alt="size(BB{ij})" /> is a bounding box around <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-3fa563d6b892f311bf3e1c27ee15fe97_l3.png" alt="r_i" /> and <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-58103e9010f6c91d7c4f4b38b28fe341_l3.png" alt="r_j" />.</p>
<h2 id="final-similarity">Final Similarity</h2>
<p>The final similarity between two regions is defined as a linear combination of aforementioned 4 similarities.</p>
<figure>
<img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-67a3c5c3f45a9407ee513056c759f095_l3.png" alt="s(r_i, r_j) = a_1s_{color}(r_i, r_j) + a_2s_{texture}(r_i, r_j) + a_3s_{size}(r_i, r_j)+ a_4s_{fill}(r_i, r_j)" /><figcaption aria-hidden="true">s(r_i, r_j) = a_1s_{color}(r_i, r_j) + a_2s_{texture}(r_i, r_j) + a_3s_{size}(r_i, r_j)+ a_4s_{fill}(r_i, r_j)</figcaption>
</figure>
<p>where <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-3fa563d6b892f311bf3e1c27ee15fe97_l3.png" alt="r_i" /> and <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-58103e9010f6c91d7c4f4b38b28fe341_l3.png" alt="r_j" /> are two regions or segments in the image and <img src="https://www.learnopencv.com/wp-content/ql-cache/quicklatex.com-f58c2a1aace1c9f1cf8597ddef03ab60_l3.png" alt="a_i " /> denotes if the similarity measure is used or not.</p>
<h1 id="results">Results</h1>
<p>Selective Search implementation in OpenCV gives thousands of region proposals arranged in decreasing order of objectness. For clarity, we are sharing results with top 200-250 boxes drawn over the image. In general 1000-1200 proposals are good enough to get all the correct region proposals.</p>
<figure>
<img src="https://i.imgur.com/Ija12KT.png" alt="image-20200330120116871" /><figcaption aria-hidden="true">image-20200330120116871</figcaption>
</figure>
<h2 id="selective-search-python">Selective Search: Python</h2>
<p>Let’s take a look on how can we use Selective Search based segmentation implemented in OpenCV.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Usage:</span></span><br><span class="line"><span class="string">    ./ssearch.py input_image (f|q)</span></span><br><span class="line"><span class="string">    f=fast, q=quality</span></span><br><span class="line"><span class="string">Use "l" to display less rects, 'm' to display more rects, "q" to quit.</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># If image path and f/q is not passed as command</span></span><br><span class="line">    <span class="comment"># line arguments, quit and display help message</span></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">3</span>:</span><br><span class="line">        print(__doc__)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># speed-up using multithreads</span></span><br><span class="line">    cv2.setUseOptimized(<span class="literal">True</span>);</span><br><span class="line">    cv2.setNumThreads(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># read image</span></span><br><span class="line">    im = cv2.imread(sys.argv[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># resize image</span></span><br><span class="line">    newHeight = <span class="number">200</span></span><br><span class="line">    newWidth = int(im.shape[<span class="number">1</span>]*<span class="number">200</span>/im.shape[<span class="number">0</span>])</span><br><span class="line">    im = cv2.resize(im, (newWidth, newHeight))    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># create Selective Search Segmentation Object using default parameters</span></span><br><span class="line">    ss = cv2.ximgproc.segmentation.createSelectiveSearchSegmentation()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># set input image on which we will run segmentation</span></span><br><span class="line">    ss.setBaseImage(im)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Switch to fast but low recall Selective Search method</span></span><br><span class="line">    <span class="keyword">if</span> (sys.argv[<span class="number">2</span>] == <span class="string">'f'</span>):</span><br><span class="line">        ss.switchToSelectiveSearchFast()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Switch to high recall but slow Selective Search method</span></span><br><span class="line">    <span class="keyword">elif</span> (sys.argv[<span class="number">2</span>] == <span class="string">'q'</span>):</span><br><span class="line">        ss.switchToSelectiveSearchQuality()</span><br><span class="line">    <span class="comment"># if argument is neither f nor q print help message</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(__doc__)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># run selective search segmentation on input image</span></span><br><span class="line">    rects = ss.process()</span><br><span class="line">    print(<span class="string">'Total Number of Region Proposals: &#123;&#125;'</span>.format(len(rects)))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># number of region proposals to show</span></span><br><span class="line">    numShowRects = <span class="number">100</span></span><br><span class="line">    <span class="comment"># increment to increase/decrease total number</span></span><br><span class="line">    <span class="comment"># of reason proposals to be shown</span></span><br><span class="line">    increment = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># create a copy of original image</span></span><br><span class="line">        imOut = im.copy()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># itereate over all the region proposals</span></span><br><span class="line">        <span class="keyword">for</span> i, rect <span class="keyword">in</span> enumerate(rects):</span><br><span class="line">            <span class="comment"># draw rectangle for region proposal till numShowRects</span></span><br><span class="line">            <span class="keyword">if</span> (i &lt; numShowRects):</span><br><span class="line">                x, y, w, h = rect</span><br><span class="line">                cv2.rectangle(imOut, (x, y), (x+w, y+h), (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">1</span>, cv2.LINE_AA)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># show output</span></span><br><span class="line">        cv2.imshow(<span class="string">"Output"</span>, imOut)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># record key press</span></span><br><span class="line">        k = cv2.waitKey(<span class="number">0</span>) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># m is pressed</span></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">109</span>:</span><br><span class="line">            <span class="comment"># increase total number of rectangles to show by increment</span></span><br><span class="line">            numShowRects += increment</span><br><span class="line">        <span class="comment"># l is pressed</span></span><br><span class="line">        <span class="keyword">elif</span> k == <span class="number">108</span> <span class="keyword">and</span> numShowRects &gt; increment:</span><br><span class="line">            <span class="comment"># decrease total number of rectangles to show by increment</span></span><br><span class="line">            numShowRects -= increment</span><br><span class="line">        <span class="comment"># q is pressed</span></span><br><span class="line">        <span class="keyword">elif</span> k == <span class="number">113</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># close image show window</span></span><br><span class="line">    cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<hr />
<p>🌲<strong>Recap</strong></p>
<p>Precision = <span class="math inline">\(\frac{tp}{tp + fp}\)</span></p>
<p>Recal = <span class="math inline">\(\frac{tp}{tp + fn}\)</span></p>
<p>Imbalanced Acurray = <span class="math inline">\(\frac{tp + tn}{tp + tn + fp + fn}\)</span> = <span class="math inline">\(\frac{\#classified\quad correctly}{\#all}\)</span> (if the dataset is imbalanced, this metric will be misleading cuz it’s gonna be very high, see <a href="https://en.wikipedia.org/wiki/Precision_and_recall" target="_blank" rel="noopener">example</a>)</p>
<p>Balanced Acurracy = <span class="math inline">\(\frac{TPR + TNR}{2}\)</span></p>
<p>Eg:</p>
<p>Consider a sample with 95 negative and 5 positive values.</p>
<p>Classifying all values as negative in this case.</p>
<p>Imbalanced Acurray = <span class="math inline">\(\frac{tp + tn}{tp + tn + fp + fn}\)</span> = <span class="math inline">\(\frac{0 + 95}{100}\)</span> = 0.95</p>
<p>Balanced Acurray = <span class="math inline">\(\frac{TPR + TNR}{2}\)</span> = <span class="math inline">\(\frac{0/5+95/95}{2}\)</span> = 0.5</p>
<figure>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Precisionrecall.svg/350px-Precisionrecall.svg.png" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>
<figure>
<img src="https://i.imgur.com/IlBW3bP.png" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>

    </div>

    
    
    
        <div class="reward-container">
  <div>谢谢老板🐱~.</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/reward.png" alt="Nansong Yi WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Nansong Yi Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>

        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/rss.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/30/hello-world/" rel="prev" title="Hello World">
      <i class="fa fa-chevron-left"></i> Hello World
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/10/11/ECE-PMP-545-Mobile-Car/" rel="next" title="ECE PMP 545 - Mobile Car">
      ECE PMP 545 - Mobile Car <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#object-detections"><span class="nav-number">1.</span> <span class="nav-text">Object Detections</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#image-segementationsemantic-segmentation"><span class="nav-number">2.</span> <span class="nav-text">Image Segementation&#x2F;Semantic Segmentation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#metrics"><span class="nav-number">3.</span> <span class="nav-text">Metrics:</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#accuracy"><span class="nav-number">3.1.</span> <span class="nav-text">Accuracy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#precision-recall"><span class="nav-number">3.2.</span> <span class="nav-text">Precision &amp; recall</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#precision---recall-curve"><span class="nav-number">3.3.</span> <span class="nav-text">Precision - Recall Curve</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#roc-curve-tpr---fpr"><span class="nav-number">3.4.</span> <span class="nav-text">ROC curve: TPR - FPR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iou-intersection-over-union"><span class="nav-number">3.5.</span> <span class="nav-text">IoU (Intersection over union)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yolov1"><span class="nav-number">4.</span> <span class="nav-text">YOLOv1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#what-is-selective-search"><span class="nav-number">5.</span> <span class="nav-text">What is Selective Search?</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#similarity"><span class="nav-number"></span> <span class="nav-text">Similarity</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#color-similarity"><span class="nav-number">1.</span> <span class="nav-text">Color Similarity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#texture-similarity"><span class="nav-number">2.</span> <span class="nav-text">Texture Similarity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#size-similarity"><span class="nav-number">3.</span> <span class="nav-text">Size Similarity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shape-compatibility"><span class="nav-number">4.</span> <span class="nav-text">Shape Compatibility</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#final-similarity"><span class="nav-number">5.</span> <span class="nav-text">Final Similarity</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#results"><span class="nav-number"></span> <span class="nav-text">Results</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#selective-search-python"><span class="nav-number">1.</span> <span class="nav-text">Selective Search: Python</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Nansong Yi"
      src="/images/baby.png">
  <p class="site-author-name" itemprop="name">Nansong Yi</p>
  <div class="site-description" itemprop="description">TheSong is named after IG.TheShy</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/nansongyi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;nansongyi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:nansong@uw.edu" title="E-Mail → mailto:nansong@uw.edu" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://nansongyi.me/" title="http:&#x2F;&#x2F;nansongyi.me" rel="noopener" target="_blank">my web</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://silencial.github.io/" title="https:&#x2F;&#x2F;silencial.github.io&#x2F;" rel="noopener" target="_blank">silencial</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://3monks.org/en/" title="https:&#x2F;&#x2F;3monks.org&#x2F;en&#x2F;" rel="noopener" target="_blank">sky</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.twistedwg.com/pages/class.html" title="http:&#x2F;&#x2F;www.twistedwg.com&#x2F;pages&#x2F;class.html" rel="noopener" target="_blank">twistedwg</a>
        </li>
    </ul>
  </div>

      </div>

      <div style="position:absolute; bottom:120px left:auto; width:85%">
          <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=450 src="//music.163.com/outchain/player?type=0&id=5290225297&auto=1&height=430"></iframe>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nansong Yi</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>














    <div id="pjax">
  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

    </div>
</body>
</html>
